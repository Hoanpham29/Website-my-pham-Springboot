<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Danh sách sản phẩm</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="bg-gray-100">

<div th:if="${successMessage}"
     id="toast"
     class="fixed top-4 inset-x-0 mx-auto bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg opacity-0 transition-opacity duration-500 w-max">
    <p th:text="${successMessage}"></p>
</div>

<div class="flex flex-col min-h-screen">

    <header th:replace="~{admin/header :: header}"></header>

    <div class="flex flex-1">

        <aside th:replace="~{admin/sidebar :: sidebar}"
               class="fixed left-0 top-0 h-screen w-64 bg-gray-800 text-white"></aside>

        <main class="flex-1 p-6 ml-56">

            <div class="flex items-center justify-between mb-6">
                <h1 class="text-3xl font-bold">Quản lý sản phẩm</h1>

                <div class="flex flex-col items-center justify-center">
                    <form action="" method="get" class="flex items-center">
                        <input
                                type="text"
                                name="query"
                                placeholder="Tìm kiếm sản phẩm..."
                                class="border border-gray-300 rounded-l-lg px-3 py-2 w-64 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <button
                                type="submit"
                                class="bg-blue-600 text-white px-4 py-2 rounded-r-lg hover:bg-blue-700 transition">
                            <i class="fas fa-search"></i>
                        </button>
                    </form>
                </div>

                <button
                        onclick="openAddModal()"
                        class="bg-green-600 text-white rounded-md flex items-center px-4 py-2 hover:bg-green-700 transition">
                    <i class="fas fa-plus mr-2"></i> Thêm sản phẩm mới
                </button>

                <div id="addModal" class="hidden fixed inset-0 flex items-center justify-center bg-gray-500 bg-opacity-50">
                    <div class=" max-h-[95vh] overflow-y-scroll [scrollbar-width:none] [-ms-overflow-style:none] [&::-webkit-scrollbar]:hidden modal-content bg-white p-6 rounded-lg shadow-lg w-[30vw]">
                        <h2 class="text-xl font-semibold mb-4">Thêm sản phẩm mới</h2>

                        <form id="addProductForm"
                              th:action="@{/admin/sanpham/them}"
                              th:object="${product}"
                              method="POST"
                              enctype="multipart/form-data">

                            <div>
                                <label class="block text-sm font-medium text-gray-700">Tên sản phẩm</label>
                                <input type="text" th:field="*{ten}" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required>
                            </div>

                            <div class="mt-2">
                                <label class="block text-sm font-medium text-gray-700">Phân loại</label>
                                <input type="text" th:field="*{phanloai}" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required>
                            </div>

                            <div class="mt-2">
                                <label class="block text-sm font-medium text-gray-700">Nhà cung cấp</label>
                                <input type="text" th:field="*{nhaCungCap}" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required>
                            </div>

                            <div class="mt-2">
                                <label class="block text-sm font-medium text-gray-700">Dung tích</label>
                                <input type="number" th:field="*{dungtich}" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required>
                            </div>

                            <div class="mt-2">
                                <label class="block text-sm font-medium text-gray-700">Mô tả</label>
                                <textarea th:field="*{moTa}" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required></textarea>
                            </div>

                            <div class="mt-2">
                                <label class="block text-sm font-medium text-gray-700">Giá</label>
                                <input type="number" step="0.01" th:field="*{gia}"
                                       class="mt-1 p-2 w-full border border-gray-300 rounded-md" required>
                            </div>

                            <div class="mt-2">
                                <label class="block text-sm font-medium text-gray-700">Giảm giá (%)</label>
                                <input type="number" th:field="*{giamGia}" class="mt-1 p-2 w-full border border-gray-300 rounded-md">
                            </div>

                            <div class="mt-2">
                                <label class="block text-sm font-medium text-gray-700">Số lượng tồn kho</label>
                                <input type="number" th:field="*{soLuongTonKho}" class="mt-1 p-2 w-full border border-gray-300 rounded-md" required>
                            </div>

                            <div class="mt-2">
                                <label class="block text-sm font-medium text-gray-700">Đã bán</label>
                                <input type="number" th:field="*{daban}" class="mt-1 p-2 w-full border border-gray-300 rounded-md" value="0">
                            </div>

                            <div class="mt-2">
                                <label class="block text-sm font-medium text-gray-700">Hình ảnh (file)</label>
                                <input type="file" name="imageFile" class="mt-1 p-2 w-full border border-gray-300 rounded-md" accept="image/*">
                            </div>

                            <div class="mt-2">
                                <label class="block text-sm font-medium text-gray-700">Ngày nhập hàng</label>
                                <input type="datetime-local" th:field="*{ngaynhap}"
                                       class="mt-1 p-2 w-full border border-gray-300 rounded-md"
                                       required>
                            </div>

                            <div class="mt-4 text-right">
                                <button type="submit" class="submit bg-green-500 text-white px-4 py-2 rounded-md">Thêm sản phẩm</button>
                                <button type="button" onclick="closeAddModal()" class="ml-2 bg-gray-500 text-white p-2 rounded-md">Đóng</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-6">
                <div th:each="p : ${products}"
                     class="bg-white rounded-2xl shadow-md p-3 border border-gray-100">

                    <div class="flex justify-between items-start items-center">

                        <div class="flex gap-4 flex-1">
                            <div class="w-24 h-24 flex-shrink-0">
                                <img th:src="@{'/' + ${p.hinhAnh}}"
                                     class="w-full h-full object-cover rounded-xl"
                                     th:alt="${p.ten}">
                            </div>

                            <div class="flex flex-col justify-between flex-1">
                                <h3 class="h-22 font-semibold text-lg text-gray-800" th:text="${p.ten}"></h3>

                                <p class="mt-1 text-sm text-gray-500" th:text="'Kho: ' + ${p.soLuongTonKho}"></p>

                                <div class="mt-1 flex items-center gap-2">
                                    <p th:if="${p.giamGia > 0}"
                                       class="text-gray-400 line-through text-sm"
                                       th:text="${#numbers.formatDecimal(p.gia, 0, 'COMMA', 0, 'POINT')} + '₫'"></p>

                                    <p th:if="${p.giamGia > 0}"
                                       class="text-pink-600 font-bold text-lg"
                                       th:text="${#numbers.formatDecimal(p.gia * (100 - p.giamGia) / 100, 0, 'COMMA', 0, 'POINT')} + '₫'"></p>

                                    <p th:unless="${p.giamGia > 0}"
                                       class="text-gray-800 font-semibold text-lg"
                                       th:text="${#numbers.formatDecimal(p.gia, 0, 'COMMA', 0, 'POINT')} + '₫'"></p>
                                </div>
                            </div>
                        </div>

                        <div class="flex flex-row items-center justify-end flex-shrink-0 ml-4">

                            <button
                                    class="bg-white hover:bg-blue-600 transition-colors duration-800 text-grey hover:text-white px-4 py-12 w-16"
                                    th:onclick="'editProduct(' + ${p.id} + ')'">
                                <i class="fas fa-edit"></i>
                            </button>

                            <form th:action="@{/admin/sanpham/xoa/{id}(id=${p.id})}" method="post">
                                <button type="submit"
                                        class="bg-white hover:bg-red-600 transition-colors duration-300 text-gray-600 hover:text-white px-4 py-3 w-16 rounded-r-xl flex items-center justify-center">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </div>

                    </div>

                </div>
            </div>

        </main>

    </div>

    <div class="ml-[16vw] mb-4 pagination flex justify-center items-center gap-2 mt-2 select-none text-sm">

        <!-- Nút Trước -->
        <a th:if="${currentPage > 0}"
           th:href="@{/admin/sanpham(page=${currentPage - 1})}"
           class="flex items-center justify-center w-9 h-9 border rounded-full bg-white text-gray-600 hover:bg-pink-50 hover:text-pink-600 transition duration-200 shadow-sm">
            <i class="fa-solid fa-chevron-left text-xs"></i>
        </a>
        <span th:unless="${currentPage > 0}"
              class="flex items-center justify-center w-9 h-9 border rounded-full bg-gray-100 text-gray-400 cursor-not-allowed shadow-sm">
        <i class="fa-solid fa-chevron-left text-xs"></i>
        </span>

        <!-- Các trang -->
        <span th:each="page : ${#numbers.sequence(0, totalPages - 1)}">
        <a th:if="${page != currentPage}"
           th:href="@{/admin/sanpham(page=${page})}"
           th:text="${page + 1}"
           class="w-9 h-9 flex items-center justify-center border rounded-full bg-white text-gray-600 hover:bg-pink-50 hover:text-pink-600 transition duration-200 shadow-sm">
        </a>
        <span th:if="${page == currentPage}"
              th:text="${page + 1}"
              class="w-9 h-9 flex items-center justify-center border rounded-full bg-pink-600 text-white font-semibold shadow-md">
        </span>
    </span>

        <!-- Nút Sau -->
        <a th:if="${currentPage < totalPages - 1}"
           th:href="@{/admin/sanpham(page=${currentPage + 1})}"
           class="flex items-center justify-center w-9 h-9 border rounded-full bg-white text-gray-600 hover:bg-pink-50 hover:text-pink-600 transition duration-200 shadow-sm">
            <i class="fa-solid fa-chevron-right text-xs"></i>
        </a>
        <span th:unless="${currentPage < totalPages - 1}"
              class="flex items-center justify-center w-9 h-9 border rounded-full bg-gray-100 text-gray-400 cursor-not-allowed shadow-sm">
        <i class="fa-solid fa-chevron-right text-xs"></i>
    </span>
    </div>

</div>


<script>
    document.addEventListener("DOMContentLoaded", function() {
        const toast = document.getElementById('toast');
        if(toast) {
            // Hiển thị toast
            toast.classList.remove('opacity-0');
            toast.classList.add('opacity-100');

            // 3 giây sau ẩn toast
            setTimeout(() => {
                toast.classList.remove('opacity-100');
                toast.classList.add('opacity-0');
            }, 3000);
        }
    });

    window.addEventListener("DOMContentLoaded", function() {
        const input = document.querySelector("input[type='datetime-local']");
        if (input) {
            const now = new Date();
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            input.value = now.toISOString().slice(0,16);
        }
    });

    function openAddModal() {
      document.getElementById("addModal").classList.remove("hidden");
    }

    function closeAddModal() {
      document.getElementById("addModal").classList.add("hidden");
    }
</script>

</body>
</html>