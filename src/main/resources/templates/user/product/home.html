<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cửa Hàng Mỹ Phẩm Trực Tuyến</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
        }

    </style>
</head>
<body class="bg-gradient-to-b from-white-50 to-white text-gray-800">

<div th:replace="user/header :: header"></div>
<main class="flex-grow">
    <section class="relative w-full mx-auto mt-8 px-16">
        <div class="relative w-full h-[450px] rounded-2xl overflow-hidden">
            <div class="relative w-full h-90 md:h-200 overflow-hidden rounded-2xl group">

                <!-- Ảnh -->
                <div class="banner-track flex transition-transform duration-700 ease-in-out">
                    <img src="/img/banner1.jpg" class="w-full h-[450px] object-cover flex-shrink-0" alt="Banner 1">
                    <img src="/img/banner2.jpg" class="w-full h-[450px] object-cover flex-shrink-0" alt="Banner 2">
                    <img src="/img/banner3.jpg" class="w-full h-[450px] object-cover flex-shrink-0" alt="Banner 3">
                </div>

                <!-- Mũi tên điều hướng -->
                <button class="h-full absolute left-4 top-1/2 -translate-y-1/2 p-2 prev"> <i class="fa fa-chevron-left text-gray-700"></i> </button>
                <button class="h-full absolute right-4 top-1/2 -translate-y-1/2  p-2 next"> <i class="fa fa-chevron-right text-gray-700"></i> </button>

                <!-- Chấm tròn -->
                <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex space-x-2">
                    <button class="dot w-3 h-3 rounded-full bg-white/60 hover:bg-white transition"></button>
                    <button class="dot w-3 h-3 rounded-full bg-white/60 hover:bg-white transition"></button>
                    <button class="dot w-3 h-3 rounded-full bg-white/60 hover:bg-white transition"></button>
                </div>
            </div>

        </div>
    </section>

    <section class="container mx-auto mt-12 px-16">
        <h2 class="text-2xl font-bold mb-6 text-center text-pink-600">Sản phẩm nổi bật</h2>

        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-4 gap-6">
            <div th:each="p : ${products}"
                 class="bg-white rounded-2xl shadow-md hover:shadow-2xl hover:shadow-pink-200
                 hover:border-pink-300 hover:-translate-y-2 hover:scale-105 transition-all duration-200 p-4
                 text-center group border border-gray-100 cursor-pointer">
                <a th:href="@{'/user/product/' + ${p.id}}"
                   class="block transition-all text-center h-[500px] flex flex-col justify-between">
                    <div class="relative">
                        <img th:src="${p.hinhAnh}"
                             class="w-full h-80 object-cover rounded-xl group-hover:scale-105 transition-transform duration-300 p-2"
                             th:alt="${p.ten}">
                        <span th:if="${p.giamGia > 0}"
                              class="absolute top-2 left-2 bg-pink-500 text-white text-xs font-semibold px-2 py-1 rounded-full">
                              -<span th:text="${p.giamGia}"></span>%
                        </span>
                    </div>
                    <h3 class="mt-3 h-[50px] font-semibold text-base text-gray-700 line-clamp-2" th:text="${p.ten}">Tên sản phẩm</h3>
                    <p class="text-sm text-gray-500" th:text="'Kho: ' + ${p.soLuongTonKho}">Kho</p>

                    <div class="mt-2 flex items-center justify-center gap-2">
                        <p th:if="${p.giamGia > 0}"
                           class="text-gray-400 line-through text-sm"
                           th:text="${#numbers.formatDecimal(p.gia, 0, 'COMMA', 0, 'POINT')} + '₫'">
                        </p>

                        <p th:if="${p.giamGia > 0}"
                           class="text-pink-600 font-bold text-lg"
                           th:text="${#numbers.formatDecimal(p.gia * (100 - p.giamGia) / 100, 0, 'COMMA', 0, 'POINT')} + ' ₫'">
                        </p>

                        <p th:unless="${p.giamGia > 0}"
                           class="text-gray-800 font-semibold text-lg"
                           th:text="${#numbers.formatDecimal(p.gia, 0, 'COMMA', 0, 'POINT')} + '₫'">
                        </p>
                    </div>

                    <form th:action="@{/user/gio-hang/add}" method="post">
                        <input type="hidden" name="productId" th:value="${p.id}">
                        <input type="hidden" name="soLuong" value="1">
                        <button type="submit"
                                class="mt-2 w-full bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 text-white rounded-full py-2 shadow-sm transition"
                                onclick="alert('Đã thêm sản phẩm và giỏ thành công!')">

                            <i class="fa fa-cart-shopping mr-2"></i>Thêm vào giỏ
                        </button>
                    </form>

                </a>
            </div>
        </div>

        <!-- Phân trang -->
        <div class="pagination flex justify-center items-center gap-2 mt-12 select-none text-sm">

            <!-- Nút Trước -->
            <a th:if="${currentPage > 0}"
               th:href="@{/user(page=${currentPage - 1})}"
               class="flex items-center justify-center w-9 h-9 border rounded-full bg-white text-gray-600 hover:bg-pink-50 hover:text-pink-600 transition duration-200 shadow-sm">
                <i class="fa-solid fa-chevron-left text-xs"></i>
            </a>
            <span th:unless="${currentPage > 0}"
                  class="flex items-center justify-center w-9 h-9 border rounded-full bg-gray-100 text-gray-400 cursor-not-allowed shadow-sm">
            <i class="fa-solid fa-chevron-left text-xs"></i>
        </span>

            <!-- Các trang -->
            <span th:each="page : ${#numbers.sequence(0, totalPages - 1)}">
            <a th:if="${page != currentPage}"
               th:href="@{/user(page=${page})}"
               th:text="${page + 1}"
               class="w-9 h-9 flex items-center justify-center border rounded-full bg-white text-gray-600 hover:bg-pink-50 hover:text-pink-600 transition duration-200 shadow-sm">
            </a>
            <span th:if="${page == currentPage}"
                  th:text="${page + 1}"
                  class="w-9 h-9 flex items-center justify-center border rounded-full bg-pink-600 text-white font-semibold shadow-md">
            </span>
        </span>

            <!-- Nút Sau -->
            <a th:if="${currentPage < totalPages - 1}"
               th:href="@{/user(page=${currentPage + 1})}"
               class="flex items-center justify-center w-9 h-9 border rounded-full bg-white text-gray-600 hover:bg-pink-50 hover:text-pink-600 transition duration-200 shadow-sm">
                <i class="fa-solid fa-chevron-right text-xs"></i>
            </a>
            <span th:unless="${currentPage < totalPages - 1}"
                  class="flex items-center justify-center w-9 h-9 border rounded-full bg-gray-100 text-gray-400 cursor-not-allowed shadow-sm">
            <i class="fa-solid fa-chevron-right text-xs"></i>
        </span>
        </div>
    </section>

</main>
<div th:replace="fragment/footer :: footer" class="mt-16"></div>

<script>
    const track = document.querySelector('.banner-track');
    const dots = document.querySelectorAll('.dot');
    const prev = document.querySelector('.prev');
    const next = document.querySelector('.next');
    let idx = 0;
    const total = dots.length;
    let interval;

    function showImage(i) {
      idx = i;
      track.style.transform = `translateX(-${i * 100}%)`;

      dots.forEach((dot, j) => {
        dot.classList.toggle('bg-white', j === i);
        dot.classList.toggle('bg-white/60', j !== i);
      });
    }

    function nextImage() {
      showImage((idx + 1) % total);
    }

    function prevImage() {
      showImage((idx - 1 + total) % total);
    }

    function startAutoSlide() {
      interval = setInterval(nextImage, 4000);
    }

    function stopAutoSlide() {
      clearInterval(interval);
    }

    // Sự kiện nút và chấm
    next.addEventListener('click', () => {
      nextImage();
      stopAutoSlide();
      startAutoSlide();
    });

    prev.addEventListener('click', () => {
      prevImage();
      stopAutoSlide();
      startAutoSlide();
    });

    dots.forEach((dot, i) => {
      dot.addEventListener('click', () => {
        showImage(i);
        stopAutoSlide();
        startAutoSlide();
      });
    });

    // Khởi động
    showImage(0);
    startAutoSlide();
</script>
</body>
</html>
